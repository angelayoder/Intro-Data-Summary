# Data Summary of HRDP RNA Data from the Brain and Liver Continued 
## Angela Yoder

Goals: Use Phenogen HRDP total RNA ensemble data for Brain and Liver to calculate Broad Sense Heritability and Hierarchical Clustering

```{r}

# set working directory
setwd("C:/Users/angel/OneDrive/Desktop/Saba Lab/Data")

library(tidyverse)

# download brain and liver datasets
brain = read.csv("PhenoGen.HRDP.v5.totalRNA.Brain.gene.ensembl96.txt", header = T, sep = "\t")
liver = read.csv("PhenoGen.HRDP.v5.totalRNA.Liver.gene.ensembl96.txt", header = T, sep = "\t")
```

```{r}

library(tidyverse)
## Means of strains


# extracting strain from colname
rats_brain = sub("_.*", "", colnames(brain))
rats_liver = sub("_.*", "", colnames(liver))

# finding unique strains
strains_brain = unique(rats_brain)
strains_liver = unique(rats_liver)

# exchanging columns for rows
new_brain = t(brain)
new_liver = t(liver)

# means of rows- MISTAKE
#means_brain = apply(X = new_brain, FUN = mean, MARGIN = 1)
#means_liver = apply(X = new_liver, FUN = mean, MARGIN = 1)

# adding a strains column to new matrix
new_brain = cbind(rats_brain, new_brain)
new_liver = cbind(rats_liver, new_liver)

# creating a matrix to store means strainXgene
storagematrix = matrix(NA, nrow = length(strains_brain), ncol = dim(new_brain)[2], rownames = strains_brain, colnames = colnames(new_brain[2: length(new_brain[1,])]))

# calculate the means within each strain within each gene
for (i in 1:length(strains_brain)) # going through each strain
{
  b = new_brain[new_brain[,"rats_brain"] == strains_brain[i],] # extracting the rows where strain matches
  for (j in 2:dim(new_brain)[2]) # Going through each gene
  {
    v = mean(as.numeric(b[,j])) # calculating mean across the strain for each gene
    r = j-1
    storagematrix[i, r] = v # storing
  }
}



```